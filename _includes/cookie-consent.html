<!-- GDPR Cookie Consent Banner -->
<div id="cookieConsent" class="cookie-consent" style="display: none;">
  <div class="cookie-consent-content">
    <div class="cookie-text">
      <p>
        <strong>We value your privacy</strong><br>
        This website uses cookies to enhance your browsing experience, analyze site traffic, and serve personalized content.
        By clicking "Accept All", you consent to our use of cookies.
        <a href="/privacy/" class="cookie-link">Learn more</a>
      </p>
    </div>
    <div class="cookie-actions">
      <button onclick="acceptAllCookies()" class="cookie-btn cookie-btn-primary">
        Accept All
      </button>
      <button onclick="acceptEssentialOnly()" class="cookie-btn cookie-btn-secondary">
        Essential Only
      </button>
      <button onclick="showCookieSettings()" class="cookie-btn cookie-btn-link">
        Customize
      </button>
    </div>
  </div>
</div>

<!-- Cookie Settings Modal -->
<div id="cookieSettings" class="cookie-modal" style="display: none;">
  <div class="cookie-modal-overlay" onclick="closeCookieSettings()"></div>
  <div class="cookie-modal-content">
    <div class="cookie-modal-header">
      <h2>Cookie Preferences</h2>
      <button onclick="closeCookieSettings()" class="cookie-close" aria-label="Close">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <div class="cookie-modal-body">
      <p class="cookie-description">
        We use cookies to improve your experience on our site. You can choose which types of cookies to allow.
      </p>

      <div class="cookie-category">
        <div class="cookie-category-header">
          <div>
            <h3>Essential Cookies</h3>
            <p>Required for the website to function properly</p>
          </div>
          <label class="cookie-toggle">
            <input type="checkbox" checked disabled>
            <span class="cookie-toggle-slider"></span>
          </label>
        </div>
        <div class="cookie-category-details">
          <p>
            These cookies are necessary for basic site functionality, including authentication,
            security, and accessibility features. They cannot be disabled.
          </p>
          <p class="cookie-examples"><strong>Examples:</strong> Session cookies, authentication tokens, CSRF tokens</p>
        </div>
      </div>

      <div class="cookie-category">
        <div class="cookie-category-header">
          <div>
            <h3>Analytics Cookies</h3>
            <p>Help us understand how visitors use our site</p>
          </div>
          <label class="cookie-toggle">
            <input type="checkbox" id="analyticsToggle" checked>
            <span class="cookie-toggle-slider"></span>
          </label>
        </div>
        <div class="cookie-category-details">
          <p>
            We use Google Analytics to collect anonymous data about how visitors interact with our site.
            This helps us improve the user experience.
          </p>
          <p class="cookie-examples"><strong>Provider:</strong> Google Analytics</p>
        </div>
      </div>

      <div class="cookie-category">
        <div class="cookie-category-header">
          <div>
            <h3>Functionality Cookies</h3>
            <p>Remember your preferences and settings</p>
          </div>
          <label class="cookie-toggle">
            <input type="checkbox" id="functionalityToggle" checked>
            <span class="cookie-toggle-slider"></span>
          </label>
        </div>
        <div class="cookie-category-details">
          <p>
            These cookies remember choices you make (like language preference, region) to provide
            enhanced, personalized features.
          </p>
          <p class="cookie-examples"><strong>Examples:</strong> Preferred language, display preferences</p>
        </div>
      </div>
    </div>

    <div class="cookie-modal-footer">
      <button onclick="saveCustomCookieSettings()" class="cookie-btn cookie-btn-primary">
        Save Preferences
      </button>
      <button onclick="acceptAllCookies()" class="cookie-btn cookie-btn-secondary">
        Accept All
      </button>
    </div>
  </div>
</div>

<style>
/* Cookie Consent Banner */
.cookie-consent {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: rgba(0, 46, 109, 0.98);
  color: white;
  padding: 1.5rem;
  box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.2);
  z-index: 9999;
  animation: slideUp 0.4s ease-out;
}

@keyframes slideUp {
  from {
    transform: translateY(100%);
  }
  to {
    transform: translateY(0);
  }
}

.cookie-consent-content {
  max-width: 1200px;
  margin: 0 auto;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 2rem;
}

.cookie-text {
  flex: 1;
}

.cookie-text p {
  margin: 0;
  line-height: 1.6;
  font-size: 0.95rem;
}

.cookie-text strong {
  font-size: 1.1rem;
  display: block;
  margin-bottom: 0.25rem;
}

.cookie-link {
  color: #6CACE4;
  text-decoration: underline;
  font-weight: 500;
}

.cookie-link:hover {
  color: white;
}

.cookie-actions {
  display: flex;
  gap: 0.75rem;
  flex-wrap: wrap;
}

.cookie-btn {
  padding: 0.75rem 1.5rem;
  border: none;
  border-radius: 6px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 0.95rem;
  white-space: nowrap;
}

.cookie-btn-primary {
  background: white;
  color: var(--columbia-blue);
}

.cookie-btn-primary:hover {
  background: #f0f0f0;
  transform: translateY(-2px);
}

.cookie-btn-secondary {
  background: transparent;
  color: white;
  border: 2px solid white;
}

.cookie-btn-secondary:hover {
  background: rgba(255, 255, 255, 0.1);
}

.cookie-btn-link {
  background: transparent;
  color: #6CACE4;
  text-decoration: underline;
}

.cookie-btn-link:hover {
  color: white;
}

/* Cookie Settings Modal */
.cookie-modal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 10000;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 1rem;
}

.cookie-modal-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.6);
  backdrop-filter: blur(4px);
}

.cookie-modal-content {
  position: relative;
  background: white;
  border-radius: 12px;
  max-width: 700px;
  width: 100%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  animation: modalSlideIn 0.3s ease-out;
}

@keyframes modalSlideIn {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.cookie-modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1.5rem;
  border-bottom: 2px solid #f0f0f0;
}

.cookie-modal-header h2 {
  margin: 0;
  color: var(--columbia-blue);
  font-size: 1.5rem;
}

.cookie-close {
  background: none;
  border: none;
  cursor: pointer;
  color: var(--text-light);
  padding: 0.5rem;
  display: flex;
  align-items: center;
  transition: color 0.2s ease;
}

.cookie-close:hover {
  color: var(--columbia-blue);
}

.cookie-modal-body {
  padding: 1.5rem;
}

.cookie-description {
  margin-bottom: 1.5rem;
  color: var(--text-dark);
  line-height: 1.6;
}

.cookie-category {
  border: 2px solid #f0f0f0;
  border-radius: 8px;
  padding: 1.25rem;
  margin-bottom: 1rem;
}

.cookie-category-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 1rem;
  margin-bottom: 0.75rem;
}

.cookie-category-header h3 {
  margin: 0;
  font-size: 1.1rem;
  color: var(--columbia-blue);
}

.cookie-category-header p {
  margin: 0.25rem 0 0;
  font-size: 0.9rem;
  color: var(--text-light);
}

.cookie-category-details {
  color: var(--text-dark);
  font-size: 0.9rem;
  line-height: 1.6;
}

.cookie-category-details p {
  margin: 0.5rem 0;
}

.cookie-examples {
  color: var(--text-light);
  font-size: 0.85rem;
  font-style: italic;
}

/* Toggle Switch */
.cookie-toggle {
  position: relative;
  display: inline-block;
  width: 50px;
  height: 26px;
  flex-shrink: 0;
}

.cookie-toggle input {
  opacity: 0;
  width: 0;
  height: 0;
}

.cookie-toggle-slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  transition: 0.3s;
  border-radius: 26px;
}

.cookie-toggle-slider:before {
  position: absolute;
  content: "";
  height: 18px;
  width: 18px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  transition: 0.3s;
  border-radius: 50%;
}

.cookie-toggle input:checked + .cookie-toggle-slider {
  background-color: var(--columbia-blue);
}

.cookie-toggle input:checked + .cookie-toggle-slider:before {
  transform: translateX(24px);
}

.cookie-toggle input:disabled + .cookie-toggle-slider {
  opacity: 0.5;
  cursor: not-allowed;
}

.cookie-modal-footer {
  padding: 1.5rem;
  border-top: 2px solid #f0f0f0;
  display: flex;
  gap: 1rem;
  justify-content: flex-end;
}

/* Mobile Responsive */
@media (max-width: 768px) {
  .cookie-consent-content {
    flex-direction: column;
    align-items: stretch;
  }

  .cookie-actions {
    justify-content: stretch;
  }

  .cookie-btn {
    flex: 1;
    text-align: center;
  }

  .cookie-modal-content {
    margin: 0.5rem;
  }

  .cookie-modal-footer {
    flex-direction: column;
  }

  .cookie-modal-footer .cookie-btn {
    width: 100%;
  }

  .cookie-category-header {
    flex-direction: column;
  }

  .cookie-toggle {
    align-self: flex-start;
  }
}
</style>

<script>
// Cookie consent management
(function() {
  const COOKIE_CONSENT_KEY = 'cuaa_cookie_consent';
  const CONSENT_EXPIRY_DAYS = 365;

  // Check if user has already consented
  function checkCookieConsent() {
    const consent = getCookie(COOKIE_CONSENT_KEY);
    if (!consent) {
      // Show banner after a short delay
      setTimeout(() => {
        document.getElementById('cookieConsent').style.display = 'block';
      }, 1000);
    } else {
      // Apply saved preferences
      applyConsent(JSON.parse(consent));
    }
  }

  // Accept all cookies
  window.acceptAllCookies = function() {
    const consent = {
      essential: true,
      analytics: true,
      functionality: true,
      timestamp: Date.now()
    };
    saveConsent(consent);
    document.getElementById('cookieConsent').style.display = 'none';
    closeCookieSettings();
  };

  // Accept essential only
  window.acceptEssentialOnly = function() {
    const consent = {
      essential: true,
      analytics: false,
      functionality: false,
      timestamp: Date.now()
    };
    saveConsent(consent);
    document.getElementById('cookieConsent').style.display = 'none';
  };

  // Show cookie settings modal
  window.showCookieSettings = function() {
    document.getElementById('cookieSettings').style.display = 'flex';
    document.body.style.overflow = 'hidden';
  };

  // Close cookie settings modal
  window.closeCookieSettings = function() {
    document.getElementById('cookieSettings').style.display = 'none';
    document.body.style.overflow = '';
  };

  // Save custom cookie settings
  window.saveCustomCookieSettings = function() {
    const analytics = document.getElementById('analyticsToggle').checked;
    const functionality = document.getElementById('functionalityToggle').checked;

    const consent = {
      essential: true,
      analytics: analytics,
      functionality: functionality,
      timestamp: Date.now()
    };

    saveConsent(consent);
    document.getElementById('cookieConsent').style.display = 'none';
    closeCookieSettings();
  };

  // Save consent to cookie
  function saveConsent(consent) {
    setCookie(COOKIE_CONSENT_KEY, JSON.stringify(consent), CONSENT_EXPIRY_DAYS);
    applyConsent(consent);
  }

  // Apply consent settings
  function applyConsent(consent) {
    // Enable/disable Google Analytics
    if (consent.analytics) {
      enableAnalytics();
    } else {
      disableAnalytics();
    }

    // Apply other consent settings as needed
    console.log('Cookie consent applied:', consent);
  }

  // Enable Google Analytics
  function enableAnalytics() {
    if (window.gtag) {
      gtag('consent', 'update', {
        'analytics_storage': 'granted'
      });
    }
  }

  // Disable Google Analytics
  function disableAnalytics() {
    if (window.gtag) {
      gtag('consent', 'update', {
        'analytics_storage': 'denied'
      });
    }
  }

  // Cookie helper functions
  function setCookie(name, value, days) {
    const expires = new Date();
    expires.setTime(expires.getTime() + days * 24 * 60 * 60 * 1000);
    document.cookie = name + '=' + value + ';expires=' + expires.toUTCString() + ';path=/;SameSite=Lax';
  }

  function getCookie(name) {
    const nameEQ = name + '=';
    const ca = document.cookie.split(';');
    for (let i = 0; i < ca.length; i++) {
      let c = ca[i];
      while (c.charAt(0) === ' ') c = c.substring(1, c.length);
      if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
    }
    return null;
  }

  // Initialize on page load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', checkCookieConsent);
  } else {
    checkCookieConsent();
  }
})();
</script>
